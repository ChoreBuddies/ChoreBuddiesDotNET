#!/bin/sh
echo "Running dotnet format on changed files..."

# Always run relative to repo root
cd "$(git rev-parse --show-toplevel)" || exit 1
git add .

# Path to your main solution file
SOLUTION_PATH="ChoreBuddies.Backend.sln"

# Get staged .cs files
CHANGED_FILES=$(git diff --cached --name-only --diff-filter=ACMR | grep '\.cs$')
echo "Files: $CHANGED_FILES"

if [ -z "$CHANGED_FILES" ]; then
  echo "No C# files staged. Skipping dotnet format."
  exit 0
fi

# Run dotnet format on staged files, scoped to solution
dotnet format "$SOLUTION_PATH" --include $CHANGED_FILES --verbosity diagnostic

# Stage ALL files that were changed by formatting (not only staged ones)
git add .
