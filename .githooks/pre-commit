#!/bin/sh
echo "Running dotnet format on staged files..."

# Always run relative to repo root
cd "$(git rev-parse --show-toplevel)" || exit 1

# Get staged .cs files
CHANGED_FILES=$(git diff --cached --name-only --diff-filter=ACMR | grep '\.cs$')

if [ -z "$CHANGED_FILES" ]; then
  echo "No C# files staged. Skipping dotnet format."
  exit 0
fi

# Run dotnet format only on changed files
dotnet format --include $CHANGED_FILES --verbosity minimal

# Add any reformatted files back to the commit
git add $CHANGED_FILES
