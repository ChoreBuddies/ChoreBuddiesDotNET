@using ChoreBuddies.Frontend.Features.User
@using Shared.Chores

@inject IUserService userService

<MudPaper Elevation="0" Class="pa-2">
    <MudGrid>
        <MudItem xs="1">
            <MudPaper Elevation="0" Class="icon-box">
                <MudIcon Icon="@GetIcon()" Size="Size.Medium" />
            </MudPaper>
        </MudItem>
        <MudItem xs="7" Class="align-center">
            <MudText Typo="Typo.body1" Class="fw-bold">@GetTitle()</MudText>
            <MudText Typo="Typo.body2">@GetStatus()</MudText>
        </MudItem>
        <MudItem xs="4" Class="d-flex justify-end align-center">
            <MudButton Variant="Variant.Outlined" Color="Color.Secondary">
                View Task →
            </MudButton>
        </MudItem>
    </MudGrid>
</MudPaper>

@code {
    [Parameter] public ChoreDto? _choreDto { get; set; }
    public string? _userName { get; set; }
    public string? GetTitle() => _choreDto?.Name;
    public string GetStatus()
    {
        switch (_choreDto?.Status)
        {
            case Status.Assigned:
                return $"Assigned to {_userName}";
            case Status.UnverifiedCompleted:
                return $"{_userName} is waiting for verification";
            case Status.Completed:
                return $"Completed by {_userName}";
            default:
                return _choreDto?.Status.ToString() ?? "";
        }
    }
    public string? GetIcon() => MudBlazor.FontIcons.MaterialSymbols.Outlined.CheckCircle;
    private async Task<string?> GetChoreUserName()
    {
        if (_choreDto?.UserId is not null && _choreDto.UserId > 0)
        {
            return (await userService.GetUserByIdAsync((int)(_choreDto.UserId)))?.UserName ?? String.Empty;
        }
        return String.Empty;
    }
    protected override async Task OnInitializedAsync()
    {
        _userName = (await GetChoreUserName()) ?? "someone";
    }
}

<style>
    .icon-box {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 48px;
        height: 48px;
        background-color: #f0f0f0;
        border-radius: 12px;
    }
</style>